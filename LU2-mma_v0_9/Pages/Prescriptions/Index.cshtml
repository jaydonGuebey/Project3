@page
@model Pages.Prescriptions.IndexModel
@{
    ViewData["Title"] = "Prescriptions";
}

<div class="d-flex align-items-center mb-3">
    <h2 class="me-3">Prescriptions</h2>
    <a asp-page="New" class="btn btn-primary me-3">New Prescription</a>
    @if (TempData["SuccessMessage"] != null)
    {
        <div id="successMessage" class="alert alert-success mb-0 py-2 px-3" style="white-space:nowrap;">
            @TempData["SuccessMessage"]
        </div>
    }
</div>

<div class="mb-3">
    <input type="text" class="form-control" placeholder="Filter users..." id="userFilter" oninput="filterUsers()" />
</div>

<div id="userFrame" style="height:calc(100vh - 220px); overflow-y:auto; border:1px solid #ccc; border-radius:6px; padding:1rem; margin-bottom:20px;">
    <table class="table table-striped mb-0">
        <thead>
            <tr>
                <th>Name</th>
                <th>Email</th>
                <th>Phone number</th>
            </tr>
        </thead>
        <tbody id="userTableBody">
            @foreach (var user in Model.Users)
            {
                <tr>
                    <td>@user.Username</td>
                    <td>@user.Email</td>
                    <td>@user.PhoneNumber</td>
                </tr>
            }
        </tbody>
    </table>
</div>

@section Scripts {
<script>
function filterUsers() {
    var input = document.getElementById('userFilter');
    var filter = input.value.toLowerCase();
    var rows = document.querySelectorAll('#userTableBody tr');
    rows.forEach(function(row) {
        var name = row.cells[0].textContent.toLowerCase();
        var email = row.cells[1].textContent.toLowerCase();
        if (name.includes(filter) || email.includes(filter)) {
            row.style.display = '';
        } else {
            row.style.display = 'none';
        }
    });
}

// Hide the success message if any element on the page gets focus
document.addEventListener('focusin', function (e) {
    var msg = document.getElementById('successMessage');
    if (msg) {
        msg.style.display = 'none';
    }
});
</script>
}
